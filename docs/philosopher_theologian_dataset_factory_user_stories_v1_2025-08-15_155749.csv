Epic,StoryID,Title,Role,UserStory,AcceptanceCriteria,BV,TC,RR,WSJFScore,Dependencies
F1 — Corpora & Indexing,F1-S01,Corpus folder & checksum scaffold,HLB,"As a Home-Lab Builder, I want a standard data/corpora structure with checksum files so that I can verify inputs and resume safely.","Given an empty repo | When I run 'make venv' then 'python -m src.chunk_and_index --init-only' | Then folders data/corpora, indices/{bm25,faiss}, and data/.checksums.json are created; And invalid or missing folders cause a clear non-zero exit.",5,4,4,13,
F1 — Corpora & Indexing,F1-S05,Dense index (FAISS + E5-base),MLE,"As an ML Engineer, I want a FAISS index with intfloat/multilingual-e5-base so that semantic retrieval works offline.",Given the same chunk set | When I run 'make dense' | Then indices/faiss/*.index and indices/faiss/meta.json are created with encoder dims; And a test query returns top-k=50 vectors without error.,5,4,4,13,F1-S03
F1 — Corpora & Indexing,F1-S02,Latin text loader w/ metadata,MLE,"As an ML Engineer, I want a loader that reads UTF-8 texts and extracts work, ref, text so that downstream audit can cite correctly.","Given 3 sample files | When loaded | Then each chunk has non-empty work, ref, text; And non-UTF8 files are skipped with a warning and listed in a report.",5,3,4,12,F1-S01
F1 — Corpora & Indexing,F1-S03,Configurable chunker (800/80),MLE,"As an ML Engineer, I want 800-char chunks with 80-char overlap configurable in YAML so that retrieval recall is stable.",Given configs/default.yaml | When run | Then produced chunks respect bounds ±2 chars; And consecutive chunks share ≥80 chars.,4,4,4,12,F1-S02
F1 — Corpora & Indexing,F1-S04,BM25 index build (rank_bm25),MLE,"As an ML Engineer, I want a BM25 index under indices/bm25 so that claim retrieval is fast and local.",Given a prepared chunk set | When I run 'make index' | Then a serialized BM25 is created with doc count = chunk count; And query 'gratia' returns ≥1 result for Aquinas sample corpus.,5,4,3,12,F1-S03
F1 — Corpora & Indexing,F1-S06,Index meta recorder,HLB,"As a Home-Lab Builder, I want a single indices/meta.json with encoder name, FAISS version, build date, and checksums so runs are reproducible.",Given built indices | When meta recorder runs | Then indices/meta.json exists and fields match PRD; And rebuild updates date but preserves encoder id if unchanged.,4,3,5,12,F1-S04; F1-S05
F1 — Corpora & Indexing,F1-S07,Idempotent rebuild & resume,HLB,"As a Home-Lab Builder, I want re-running 'make index dense' to be no-op when artifacts are current so rebuilds are safe.",Given current artifacts | When I rerun 'make index dense' | Then second run completes in <15% of first run time and logs 'up-to-date'; And '--force' triggers full rebuild.,4,4,4,12,F1-S04; F1-S05
F1 — Corpora & Indexing,F1-S08,Index build TTFB timer,HLB,"As a Home-Lab Builder, I want build duration recorded so we can prove TTFB ≤ 30 minutes.",Given a 50–200MB corpus | When index steps run | Then runs/<batch>/summary.json records minutes; And pipeline fails if >30m unless '--allow-slow' is set.,3,5,3,11,F1-S06
F2 — Debate Generation,F2-S02,4-bit quant fallback w/ warning,HLB,"As a Home-Lab Builder, I want automatic 4-bit load if OOM occurs so 12GB VRAM runs succeed.",Given an intentional fp16 OOM | When loader retries | Then model loads in 4-bit and logs a yellow warning.,5,5,5,15,F2-S01
F2 — Debate Generation,F2-S01,Local model loader (fp16),HLB,"As a Home-Lab Builder, I want Meta-Llama-3-8B-Instruct to load locally so I can generate debates offline.",Given proper CUDA | When I run 'python -m src.debate_loop --dry-run' | Then the model loads with torch.set_grad_enabled(False) and VRAM usage is logged.,5,5,4,14,F1-S01..S06
F2 — Debate Generation,F2-S10,OOM guardrails (max_new_tokens),HLB,"As a Home-Lab Builder, I want safe token caps to avoid VRAM crashes.",Given an excessive max_new_tokens | When debate starts | Then a red warning logs and the value is overridden to a safe default.,5,5,4,14,F2-S01
F2 — Debate Generation,F2-S03,Topics YAML schema validation,SCH,"As a Scholar, I want schema-validated topics YAML so mistakes are caught early.",Given a malformed topics file | When validator runs | Then missing persona_order or bounds fail with clear error and non-zero exit.,4,5,4,13,
F2 — Debate Generation,F2-S05,Deterministic sampling (seeded),MLE,"As an ML Engineer, I want a --seed to reproduce identical outputs.",Given the same seed | When generation runs twice | Then generated JSON files are byte-identical.,4,4,5,13,F2-S01
F2 — Debate Generation,F2-S07,Citation count 1–2 enforced & format,SCH,"As a Scholar, I want exactly 1–2 citations formatted as work/ref.",Given an output with 0 or >2 citations | When checker runs | Then generation is retried up to N and failures are logged.,5,4,4,13,F2-S04
F2 — Debate Generation,F2-S06,Word bounds 120–180 enforced,SCH,"As a Scholar, I want each turn to be 120–180 words.",Given bounds in config | When a turn is out-of-range | Then it is truncated or reprompted and the event is logged.,4,4,4,12,F2-S04
F2 — Debate Generation,F2-S04,Persona prompt templates (Latin-only),SCH,"As a Scholar, I want Latin-only persona prompts that forbid invention and require citations.",Given prompts/persona_*.txt | When debate runs | Then correct templates are loaded; And dry-run prints template names.,4,4,3,11,F2-S03
F2 — Debate Generation,F2-S09,Persist generator config & prompts,HLB,"As a Home-Lab Builder, I want gen_config and raw prompts saved per turn.",Given a generation run | When files are written | Then runs/<batch>/generated/* include gen_config and prompt_text per turn.,4,3,4,11,F2-S04
F2 — Debate Generation,F2-S08,Attach top-k retrieval candidates (optional),MLE,"As an ML Engineer, I want optional inclusion of retrieval candidates for transparency.",Given generator.attach_candidates=true | When generation runs | Then each turn JSON includes candidates[] ids and scores.,3,3,3,9,F1-S04; F1-S05
F3 — Auditing,F3-S01,Claim splitter (atomic JSON),MLE,"As an ML Engineer, I want a claim splitter that outputs atomic claims per turn.",Given a sample turn | When splitting runs | Then JSON array has ≥1 claims and no claim > 30 words.,5,5,4,14,F2-S01..S07
F3 — Auditing,F3-S04,Hybrid merge & top-3 selection,MLE,"As an ML Engineer, I want BM25+dense merged, deduped, top-3 per claim.",Given two result lists | When merged | Then duplicates are removed and top-3 by merged score are returned with provenance.,5,4,5,14,F3-S02; F3-S03
F3 — Auditing,F3-S07,Support rate per turn,MLE,"As an ML Engineer, I want support_rate = correct/total_claims saved.",Given verdicted claims | When summarized | Then audit_claim.json contains support_rate with 2 decimals.,5,5,4,14,F3-S05
F3 — Auditing,F3-S05,Verdict tagger (5 classes),SCH,"As a Scholar, I want verdicts correct|unsupported|contradicted|misattributed|anachronistic.",Given a seeded claim set | When verdicting runs | Then each claim is assigned one of the 5 classes; And mapping rules are documented.,5,4,4,13,F3-S04
F3 — Auditing,F3-S02,BM25 retrieve top-50/claim,MLE,"As an ML Engineer, I want BM25 top-50 results per claim.",Given a claim | When BM25 runs | Then at least 1 result references the expected work for a known test case.,4,4,4,12,F1-S04; F3-S01
F3 — Auditing,F3-S03,Dense retrieve top-50/claim,MLE,"As an ML Engineer, I want dense top-50 results per claim.",Given a claim | When dense retrieval runs | Then latency per claim ≤ 300 ms on CPU baseline and results are returned.,4,4,4,12,F1-S05; F3-S01
F3 — Auditing,F3-S06,Evidence refs (work/ref + snippet),SCH,"As a Scholar, I want evidence refs with work, ref, and a 200-char snippet.",Given supported claims | When saved | Then every correct claim includes ≥1 evidence ref and non-empty snippet.,4,4,4,12,F3-S04
F3 — Auditing,F3-S08,Reranker toggle stub (off by default),MLE,"As an ML Engineer, I want a config flag to enable future cross-encoder reranking.",Given auditor.reranker flag | When set true | Then system logs 'not enabled in v1.0'; When false | Then no change to flow.,3,2,4,9,F3-S04
F4 — Quality Gate,F4-S04,Novelty Jaccard ≤ 0.85 vs cache,MLE,"As an ML Engineer, I want novelty check against a 5-gram shingle cache.",Given a near-duplicate turn | When gate runs | Then novelty_jaccard > 0.85 leads to rejection; And accepted turns update cache.,5,5,5,15,F2-S05
F4 — Quality Gate,F4-S02,Latinness heuristic (stopword ratio),SCH,"As a Scholar, I want a Latinness score ≥ 0.20 heuristic.",Given Latin and English samples | When scored | Then Latin scores higher; And gate records latin_score in metrics.,5,5,4,14,
F4 — Quality Gate,F4-S05,Route to accepted/rejected with reason,HLB,"As a Home-Lab Builder, I want accepted vs rejected folders with gate_result.json.",Given a batch | When gate completes | Then files reside under runs/<batch>/accepted or .../rejected with reason included.,5,4,4,13,F4-S01; F4-S02; F4-S03; F4-S04
F4 — Quality Gate,F4-S01,Word count threshold check,HLB,"As a Home-Lab Builder, I want gate to compute words and enforce 120–180.",Given an audited turn | When gate runs | Then out-of-range turns are rejected with reason=word_bounds.,4,4,4,12,F2-S06
F4 — Quality Gate,F4-S03,Citations range check (1–2),SCH,"As a Scholar, I want citations count enforced at gate.",Given a turn with 3 citations | When gate runs | Then it is rejected with gate_reason=too_many_citations.,4,4,4,12,F2-S07
F4 — Quality Gate,F4-S06,Gate perf ≤ 200 ms/turn,MLE,"As an ML Engineer, I want gate timings recorded and under 200 ms.",Given timing enabled | When gate runs | Then summary logs show mean and p95 ≤ 200 ms on sample data.,3,4,3,10,F4-S01..S04
F5 — Packaging,F5-S01,SFT JSONL packer (deterministic IDs),MLE,"As an ML Engineer, I want SFT items with deterministic <batch>.<uuid> IDs and meta fields.",Given accepted turns | When SFT pack runs | Then schema validates 100% and IDs are stable across reruns with same seed.,5,5,5,15,F4-S05
F5 — Packaging,F5-S03,JSON schema validators (fail-closed),HLB,"As a Home-Lab Builder, I want pack to fail if schema validation isn’t 100%.",Given an invalid item | When schema check runs | Then packer exits with non-zero and prints offending line.,5,5,5,15,F5-S01; F5-S02
F5 — Packaging,F5-S02,DPO pairer (nearest rejected/ablated),MLE,"As an ML Engineer, I want DPO pairs using nearest rejected else ablated accepted.","Given accepted and rejected turns | When DPO pack runs | Then each (speaker,topic) yields exactly one chosen and one rejected.",4,4,5,13,F4-S05
F5 — Packaging,F5-S05,Deterministic ordering & commit pin,MLE,"As an ML Engineer, I want items sorted and commit SHA recorded.",Given a packed dataset | When re-packed with same commit | Then file hash is identical.,4,4,5,13,F5-S01
F5 — Packaging,F5-S04,Dataset cards generator (+attribution),SCH,"As a Scholar, I want datasets/cards/<batch>.md listing editions, licenses, and 'Built with Meta Llama 3'.",Given config editions/licenses | When card generator runs | Then card contains editions table and license strings.,4,3,4,11,F5-S01
F6 — CLI & Automation,F6-S03,Makefile: debate audit gate pack all,HLB,"As a Home-Lab Builder, I want one-liners for each stage and an 'all' pipeline.",Given a valid setup | When I run 'make all' | Then index→debate→audit→gate→pack completes and exits 0.,5,5,5,15,F6-S02; F1..F5
F6 — CLI & Automation,F6-S05,auto_runner.py end-to-end orchestrator,HLB,"As a Home-Lab Builder, I want 'python -m src.auto_runner --config ... --topics ...' to run end-to-end.",Given valid config and topics | When I run auto_runner | Then runs/<batch>/summary.json is produced with KPI fields.,5,5,5,15,F1..F5 minimal artifacts
F6 — CLI & Automation,F6-S01,Makefile: venv,HLB,"As a Home-Lab Builder, I want 'make venv' to set up Python 3.10+ with pinned deps.","Given no venv | When I run 'make venv' | Then .venv is created and versions (torch, transformers, faiss) are printed.",5,5,4,14,
F6 — CLI & Automation,F6-S02,Makefile: index and dense,HLB,"As a Home-Lab Builder, I want 'make index' and 'make dense' targets.",Given built code | When I run 'make index dense' | Then targets succeed idempotently and chain correctly.,5,4,4,13,F6-S01; F1
F6 — CLI & Automation,F6-S06,Dry-run mode,SCH,"As a Scholar, I want --dry-run to simulate without writing datasets.",Given --dry-run | When pipeline runs | Then logs planned counts and no datasets/* are created.,4,4,4,12,F6-S05
F6 — CLI & Automation,F6-S04,run.sh wrapper with color help,HLB,"As a Home-Lab Builder, I want a friendly wrapper with --help and colored summaries.",Given the repo | When I run './run.sh --help' | Then stages and examples are listed; invalid args exit non-zero.,4,4,3,11,F6-S03
F7 — Observability & Reproducibility,F7-S01,"Capture versions, seeds, configs",MLE,"As an ML Engineer, I want to snapshot versions, RNG seed, and config for replay.",Given a batch run | When summary is written | Then runs/<batch>/summary.json contains versions{} and seed.,5,5,5,15,F6-S05
F7 — Observability & Reproducibility,F7-S04,Determinism check (same seed → same shards),MLE,"As an ML Engineer, I want a test that rerunning with same seed yields identical SFT file hash.",Given two identical runs | When compared | Then SHA256 of SFT file matches.,5,5,5,15,F5-S01; F6-S05
F7 — Observability & Reproducibility,F7-S02,Stage logs (human+JSON),HLB,"As a Home-Lab Builder, I want timestamped log files per stage and optional JSON logs.",Given logging enabled | When stages execute | Then runs/<batch>/logs/*.log exist; --json-log writes .jsonl entries.,4,4,4,12,F6-S05
F7 — Observability & Reproducibility,F7-S05,GPU preflight & no-PII assert,HLB,"As a Home-Lab Builder, I want a preflight check for CUDA/VRAM and a static assert that no PII is logged.",Given 'make preflight' | When executed | Then VRAM is reported with warning if <12GB; And log scan finds no PII patterns.,4,4,4,12,F6-S01
F7 — Observability & Reproducibility,F7-S03,Rotating log policy,HLB,"As a Home-Lab Builder, I want logs to rotate to avoid disk bloat.",Given long-running batches | When logs exceed size | Then rotation keeps ≤ 5 files per stage at ≤ 10 MB each.,3,3,3,9,F7-S02
QA — Cross-cutting,QA-S01,Tiny corpus smoke test (E2E),HLB,"As a Home-Lab Builder, I want a tiny corpus E2E smoke test that runs in <3 minutes.",Given a tiny corpus | When I run 'make smoke' | Then accepted or rejected outputs are produced and schemas pass.,5,5,5,15,F1..F6 minimal
QA — Cross-cutting,QA-S02,"Unit tests: chunker, indexer, gate",MLE,"As an ML Engineer, I want pytest covering chunking, indexing, and gate thresholds.",Given tests | When 'pytest -q' runs | Then tests pass and coverage ≥ 70% for these modules.,4,4,5,13,F1; F4
QA — Cross-cutting,QA-S03,Regression: Latinness & support-rate set,SCH,"As a Scholar, I want a fixed seed topics set for Latinness and support-rate regression.",Given regression targets | When I run 'make regress' | Then historical vs current metrics print and deltas >±5% are flagged.,4,4,5,13,F2; F3; F4
